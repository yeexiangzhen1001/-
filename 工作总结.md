#  工作总结
## 第一阶段---工作内容概述
  &nbsp;&nbsp;**九**月初，接到我入职了第一个正式的工作任务，迎来了真正的挑战。具体的工作内容是完成云端调试功能的开发，并完成上线，起初我也不知道这个工作任务具体是做什么的，在阅读完上一个同事写的关于云端调试工具的设计文档后，我稍微有点理解了，大概就是这个云端调试工具要实现一些查询设备基本信息，查询设备路由，以及能跟踪订阅设备的功能。这样在调试某个接口出问题时，会及时返回日志信息，方便我们的技术人员快速的定位问题，已达到及时解决bug的目的。总结一下，就是我需要开发一个DebugService，这个DebugService有两个作用：
  >1、作为Http Service 来响应DebugCline的一些http请求，其中就包括查询设备信息、查询路由信息、添加/删除设备跟踪。

  >2、作为Websocket长连接的服务器，向DebugCline推送订阅的设备的跟踪数据。
  
### 总结与反思
  &nbsp;&nbsp; **在**当时虽然大概明白了我需要做什么，现在回头想想其实那时的理解还是浮于表面，并没有去剖析细节该怎么去处理，我反思了一下原因：
  >当时的我还没有接触到过多的相关信息，我是知道应该这样做，但是我对于该如何去做还是一无所知，所以说那时候对于该设计文档的理解还是浮于表面，对于里面的一些细节没有理解到位的，以至于在后面使我陷入困境。
  
## 第二阶段---工欲善其事必先利其器  
  &nbsp;&nbsp;**在**理解完设计文档之后，我开始着手编写代码了。但是要动手去做还是很困难的，说起来容易做起来难嘛。但是万万没想到我还没有到编码的那步，各种环境工具问题就已经给我搞蒙了，工欲善其事必先利其器，而对于程序员来说，这些工具环境的安装就是我们的“器”，由于公司的代码是基于一个Atreus的一个Go微服务框架，其中包含大量微服务相关框架及工具。（当时的我还不知道什么是微服务，这里后面再说）所以第一步就是要在我的虚拟机上顺利的安装该微服务框架以及跑起来该框架的一个demo，这个过程并不是很顺利，出现了各种问题，大部分原因都是一些东西没有安装或者安装的版本不对，比如grpc的版本，反正当时卡了挺长时间的，最终该demo成功的在我的虚拟机上跑起来了，在翔哥的建议下，我通过该demo实现一些简单的接口的编写（这里就有涉及到protobuf的语法，这个paotobuf就是用来定义接口的数据结构，关于这块我是不懂得，在互联网上找到资料进行学习基础语法，照着demo里的pb文件进行模仿也算是入门，知道该怎么写了），也是成功的跑起来了，通过这种简单案例的编写也让我对这个atreus框架稍微熟悉了一点。
   &nbsp;&nbsp;**按**理来说这时候就可以正式开始我的工作任务了，也就是编写相关接口代码，但其实安装熟悉atreus框架才只是刚刚开始，因为我的项目中涉及到其他接口的调用，这里就引出了公司paas平台的一些项目代码，所以目标又转到了去成功跑起来paas化平台的这些项目代码，于是我开始在本地git clone这些项目，（这里又出现了一些小问题，这个项目中有涉及到什么子模块什么的，还有分支，可能你克隆下来的代码没在主分支，导致你本地的代码不是最新的，然后你再编译他的时候就会报一些未定义啊一类的错误？？？还要注意interface这个文件的版本号，因为它里面项目的一些接口定义的pb文件是全部放在该文件夹的，我也是后面才了解到的，怪不得我当时好多项目代码都没有顺利的跑起来）
### 遇到的问题以及解决方法
> 1、在虚拟机上无法成功跑通Atreus框架里的一个demo。
> 
> 答：根据报错提示进行了相应的处理，其实主要大部分报错是某东西没有安装，在这里就不细说。其中最坑得是grpc的版本问题，在我安装完所有需要我安装的东西之后，运行demo,报如下错误：
```
# github.com/mapgoo-lab/atreus/pkg/net/rpc/warden/balancer/p2c
/vagrant/go/pkg/mod/github.com/mapgoo-lab/atreus@v0.1.42/pkg/net/rpc/warden/balancer/p2c/p2c.go:158:52: undefined: balancer.PickOptions
/vagrant/go/pkg/mod/github.com/mapgoo-lab/atreus@v0.1.42/pkg/net/rpc/warden/balancer/p2c/p2c.go:190:52: undefined: balancer.PickOptions
# github.com/mapgoo-lab/atreus/pkg/net/rpc/warden/resolver
/vagrant/go/pkg/mod/github.com/mapgoo-lab/atreus@v0.1.42/pkg/net/rpc/warden/resolver/resolver.go:58:78: undefined: resolver.BuildOption
/vagrant/go/pkg/mod/github.com/mapgoo-lab/atreus@v0.1.42/pkg/net/rpc/warden/resolver/resolver.go:117:33: undefined: resolver.ResolveNowOption
```
>原因是解决是etcd和grpc版本冲突，在go.mod文件中添加:
> replace google.golang.org/grpc v1.29.1 => google.golang.org/grpc v1.26.0
> 解决问题。


>2、看不懂protobuf文件
>
>答：通过网上资料学习protobuf基础语法，配合着demo中的pb文件，达到了能看懂pb文件写的是什么意思，并且可以自己写相关的pb文件。

>3、git clone项目代码时不了解分支，子模块的概念，导致克隆下来的代码不是最新的，在编译时报各种错误还找不到原因。
>
>答：这个问题在当时那个时间段是还没有察觉的，后面忽然发现的。怪不得当时好多项目都编译不过。

## 第三阶段---陷入误区
 &nbsp;&nbsp;**开**始编译这些项目代码，以期望能顺利在本地跑起来这些个项目，这个小目标搞了好久还是没有实现，于是同事建议先跑cap-go这个项目，为什么？因为它依赖的东西最少，于是我开始集中精力专心的搞这个，遇到错误就百度或者询问同事，每次遇到报错去询问同事的时候，在他们口中总是蹦出一些我听不懂得东西，什么你etcd没装啊之类的。这个时候我都是默默地把这些听不懂的名词记下来，在自己去百度了解这是一个什么东西，也是经过了努力终于cap-go顺利的在我的虚拟机上跑起来了，于是我就开始通过这个cap开始想查一些数据，好不容易跑起来了，想知道这个服务是怎么去使用的嘛，这里又遇到了一些小问题，就是如何使用curl去请求post或者get方法，这个东西说实话之前没有接触过，只能在百度上查资料，如何在本地去做尝试，总之这个问题不是很大，试完这个我就想试试能不能查到公司的一些设备的真实数据通过cap，就是在这时候我有接触到新的东西了，数据库，就是公司的数据放在sql server里，这是有涉及到一些MySQL的语句，总之顺利的通过了数据库、cap查到了我想要的东西。（到此为止其实我对于go微服务还是没有很理解的，这期间我就自己去看视频学习了一下go微服务，顺便了解了一下它的背景，RPC、GRPC之类的，这里说实话只是大概了解了，并没有理解很深。）
  &nbsp;&nbsp;在这时候我开始陷入了一个重大的误区中，原因是我在阅读cap代码的时候发现了其中有我想要的接口，比如什么查询设备基础信息啊，添加跟踪，删除跟踪啊，我当时就想把这些个代码給搬到我的项目里面去，我就天天看这玩意，好家伙是越陷越深啊，（后面通过反思，总结了原因其实也因为之前在理解云端调试工具的时候理解的没有到位）其实我是去调这些个已经写好的接口来直接使用就可以了，不用去重新写一遍这些接口怎么实现的。）这段时间也是浪费了好长时间。
 ### 总结与反思
>现在看来之前之所以会陷入误区的原因主要是在之前也有提过的，就是首先对那个设计文档并没有理解到位，还有一点就是没有及时与同事沟通，没有及时发现错误，导致浪费了一段时间。
 ### 问题与解决方法
>1、在大方向上走错了，理解出现了偏差。
>
>答：后面通过沟通及时发现并改正了错误。

>2、curl请求get、post方法，MySQL基本语句
>
>答：相比于前一个大方向的错误来说，这些都是算小问题，能在网上找到相关资料，通过学习可以自己解决。

>3、go微服务的了解与学习
>
>答：对于go微服务的了解还是太少，所以在此期间通过网上资料进行学习，大概了解了go微服务的相关背景，以及一些go的框架。
## 第四阶段---开始步入正轨
 &nbsp;&nbsp;**在**翔哥及时提醒之后，我及时更正错误，开始步入正轨，这里才开始正式踏出我完成任务的第一步，在同事的帮助下，我开始模仿了他们给我写的示范，顺利地写出了获取设备路由、获取设备信息、添加设备跟踪、删除设备跟踪的接口代码，这里有点小插曲，在运行它们时，自己本地上没跑起来，原来是我在调用了某个接口时，那么该接口所在的那个服务也应要先跑起来，最终解决方法是连接到其他人的DMS，DSS服务上，这才顺利解决了这个问题。
### 总结与反思
>出现错误，碰到难题要学会向同事寻求帮助，我个人在碰到难题时习惯自己去独立解决，可能就导致会延误了很长时间，最坏的结果就是时间浪费了问题还没有得到解决。
### 问题与解决方法
>1、再上传已经写好的代码到分支上时或者拉取分支代码到本地时出现很多小问题，报很多错误。
>
>答：网上教程很多，基本上可以解决大部分问题，我也是在这个阶段才猛然发现了之前所提到的克隆到本地的项目可能不是在master主分支，所以编译不过得问题，经过尝试也验证了我的想法。
## 第五阶段---新的挑战
&nbsp;&nbsp;**到**这里在接口的编写上还剩一个订阅跟踪日志的还没有完成，这个接口有点特别，因为它是用websocket方式编写的，一开始也没觉得有什么，但是在开始编写时就完成懵了，首先我开始了解什么是websocket协议，在初步理解完后，参照网上资料用go编写了一个简单的服务端，通过测试没什么问题后我给它加到了我的项目上，到这里的时候我又有点不知道怎么办了，看了设计文档这里应该是有涉及到kafka消费数据的，关于kafka是不懂的，只能是自己在网上找资料学习，经过学习对kafka的一些基本概念有了了解，知道了kafka的消费原理后，与此同时了解到公司在kafka这块是有封装好一个东西的，可以直接使用，于是在我阅读理解完项目event，DCS等，去模仿里面对于kafka这块的调用编写后，大概了解了怎么去使用这个，但是我发现学习完这些后我对于怎么编写这个接口还是不知所措，怎么在websocket建立连接之后去订阅设备啊还是不知道怎么下手，尽管在这期间一直在互联网上查找资料，但还是无济于事，于是我怀疑应该是我对于websocket的学习理解还是不够到位，于是我开始查找go的关于websocket的资料进行学习，（跟着视频学习完成了一个简单的聊天室的项目），经过再一次的对于websocket的学习貌似有了稍微的提升，对之前碰到的问题也有了点自己的想法，但是显然还是不够的。顾暂时停止了对于云端调试工具的开发，有了这篇文章的出现。
### 总结与反思
>首先对于这个接口没有完成，我感觉很抱歉，其次通过反思来发现原因所在，一个是对于Websocket以及kafka之前并没有接触过，然后可能学习的过程中并没有很好掌握好他们，以至于在面对问题时出现不知所措的局面。二是我个人觉得其实这个还是有点难度的，它的难度在于公司没有类似的例子，没有东西可以拿来参考，网上资料很多但是有用的资料确实很少。假如可以站在前人的肩膀上，那么这个任务的难度可能会降低点。
### 问题与解决方法
>1、没有很好理解websocket协议，以及如何用go写一个websocket的服务。
>
>答：通过网上资料自己学习，去理解，相关资料很多，通过模仿别人的代码去理解学习。

>2、什么是kafka，以及kafka的消费原理。
>
>答：关于这个也是通过自己去百度相关资料，去学习的，让自己尽可能的去理解他们。

## 暂时的总结
&nbsp;&nbsp;**总**的来说，由于缺乏工作经验，可能在很多工具的使用上，环境的编译上自己会踩很多坑，然后由于我没有及时沟通可能导致会耽搁很长时间，还有在完成这个任务的过程中接触的东西都是没有接触过得，全得自己重新学习，得花时间还有在学习的过程中对于这些新的东西的理解或许也没有很到位。虽然这个项目没有进行到最后，但是很多东西可能在没有接触到这个项目之前我并不知道是什么，但是在完成这个项目之后，至少对于这些例如kafka、websocket、go微服务、git等有了新的认识或者新的理解。不管之后的工作任务是什么吧，反正我会做好准备去面对它，尽自己努力去完成它。 

## 第六阶段---迎接新的挑战
### 分析问题
&nbsp;&nbsp;**在**面临新的挑战的出现时，经过一段时间发现还是没有什么进展，只能暂时停下脚步，来好好地复盘一下前段时间的工作总结，开始对这段时间的工作进行评估。在对后续工作评估时，经过仔细的思考，分析出目前为止在开发云端调试工具过程中还存在一下两个问题有待解决：
![](/imag/16050809621410.png)
>1、当有websocket连接进来时，为了订阅设备，此时是需要通过URL传入一个参数imei进来的，那么如何去建立一个我们需要的订阅列表去让传入的imei与一个websocket连接建立好关联呢。

>2、第二个问题是基于第一个问题之上的，就是在kafka消费数据时，它是会去消费订阅的主题里的数据，那么在如何在他消费一个数据的时候，去让它把数据里的imei与我们前面所建立的订阅列表里的imei去比对呢，如何在比对成功之后就再将数据传送给该imei所关联的websocket连接。

>注意：这里的话还没有涉及到kafka写入数据以及接口拦截，这两个的话对于我来说可能还没有能力去玩成它们。
### 解决问题

&nbsp;&nbsp;**在**经过仔细的评估以及对目前存在难点得分析之后，再重新制定好时间去完成云端开发调试工具的后续开发。
还分析完目前存在的技术难点之后，就开始查阅资料，因为之前一般就是在百度上面搜索资料，可能有一些资料比较少，所以之前也是一直没有搜到我想到的信息，所以这次我是在GitHub上面去查找我需要的信息，相比于百度而言，GitHub上面的案例什么的还是很多的，就是我就有了新的方向，我开始一个个的查看别人写的websocket的案例，git clone到自己本地去运行，去分析别人的代码怎么去写的，然后去选取一个最适合自己的例子，参照它的例子去模仿的写，终于也是找到了一个比较合适的，于是我就去理解它的代码，先从简单的入手，先编个简单的例子跑一跑，慢慢的再将它的改变到自己的代码中来，按照自己程序的需求来，一步步的开始完善自己的代码，就这样慢慢的解决了目前存在的第一个难点。
&nbsp;&nbsp;**在**解决第二个难点时，由于涉及到kafka消费，就按照设计文档在公司的网站上自己创建了一个kafka的主题，于是开始自己往里面先制造一些数据，先熟悉一下kafka生产数据消费数据的流程。在熟悉完流程之后，开始分析程序中的数据流，理清程序中的数据流之后，对于存在的第二个难点就迎刃而解了，很顺利的就完成了，到目前是实现了webscoket连接时通过URL传入一个imei，并且这个imei会和这个ws连接绑定到一起，在kafka消费数据这一块，当我们往kafka的主题里发送消息时，会去把消息中的imei和订阅列表中的imei对比，如果发现该imei有被订阅的话，就会把消息推送给这个imei所绑定的ws连接，这也是完成了我们预期时想要的效果。当然这其中是存在一个小细节还没有完善的，只是大体上实现了我们想要的效果。
## 第七阶段---完善细节
### 遭遇的问题
>程序无法正常退出。
>如何实现可配置化关于websocket服务那一块。
>如何去封装好wesocket服务，让main函数里面尽可能显得简单明了。
### 问题的描述以及原因
&nbsp;&nbsp;**在**这一阶段来说就是来完善代码的结构以及去修复一些小bug，比如程序无法正常退出，在执行ctrl+c之后就会卡住，这个问题还是困住我好久的，后面找到原因是由于公司的atreus框架版本太低了，导致在kafka消费时卡住退出不了了，在go.mod中将atreus版本升级到最新的，成功解决了程序无法退出的问题。
![](/imag/16050810624361.png)
&nbsp;&nbsp;**对**于实现可配置化，主要就是模仿*github.com/mapgoo-lab/atreus/pkg/conf/paladin*里面的写法，实现websocket服务的端口，路径的可配置化。
![](/imag/1605081154655.png)
&nbsp;&nbsp;**对**于封装websocket服务的话，主要靠模仿http以及grpc的封装。

到这的话总体来说，评估工作中提到的两个难点都已经解决了。
>注意：总体上来说云端开发调试工具我目前能完成的工作已经完成的差不多了，上面也有提到还有是写入kafka数据这一块的话是做不了的，还有一个是接口拦截也做不了。

### 调试接口
&nbsp;&nbsp;**接**下来需要对之前写的四个接口进行测试，细节就不多说，在调试添加/删除设备跟踪接口是遇到一个问题就是无法解析URL传入的参数，导致添加到redis里的值都是“ ”和0，
![url请求](/imag/1604990978687.png)

![redis里查看数据](/imag/16049909237709.png)

在请教完同事之后，找到了原因，原来是没有在pb文件中去定义这些请求参数结构体的属性，导致无法解析，知道原因之后也是顺利解决了这个问题。
![pb文件中定义属性](/imag/16050806728441.png)
还有一个就是在调试查询设备路由的接口，由于本地测试可能没有路由信息，顾在测试时，并没有返回路由信息。

![](/imag/16050565161529.png)
### 测试接口全过程
**测试添加设备跟踪接口：**
![](/imag/16050561755442.png)
**到redis里查看：**
![](/imag/1605056285413.png)
**测试删除设备跟踪接口：**
![](/imag/16050563477094.png)
**到redis里查看：**
![](/imag/16050563782677.png)
**测试设备基本信息接口：**
![](/imag/16050564616267.png)
**测试查询设备路由接口：**
![](/imag/16050565161529.png)
注：这里按道理应该需要返回路由信息，但是没有返回，可能是没有路由信息，暂时没法验证。
**测试订阅设备跟踪日志接口：**
启动DebugService服务：
![](/imag/16050819386767.png)
websocket连接：
![](/imag/16050818734524.png)
模拟kafka发送消息：
![](/imag/16050823135740.png)
推送数据到客户端：
![](/imag/16050823747284.png)
退出程序：
![](/imag/16050826504706.png)

好到此为止，在大体上是已经完成了任务。

## 阶段性的总结
&nbsp;&nbsp;**在**完成这次工作任务的过程中是充满挑战的，但是在面对这些挑战并且完成了挑战的过程中是充满丰收的。无论是在工作经验上的还是知识上的，对于我来说无疑都是很宝贵的。这段时间也让我学到了很多之前到课本中所学不到的知识并且还将这些知识用到了实际工作当中去，还有很多工具的使用以及很多工作经验，比如在遇到程序跑不通时可以通过打日志的方式来定位是代码中的那一块出现了问题，这样方便我们查找以及解决问题。